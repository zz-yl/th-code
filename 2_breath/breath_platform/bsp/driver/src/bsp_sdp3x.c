/**@file   bsp_sdp3x.c
* @brief   sdp3x压差传感器驱动
* @version 1.00.0.0
**************************************************************************************************/

/**************************************************************************************************
*                                      INCLUDE FILES
**************************************************************************************************/

#include "bsp_sdp3x.h"
#include "bsp_i2c.h"

/**************************************************************************************************
*                                      MACROS DEFINE
**************************************************************************************************/

/**************************************************************************************************
*                                      DATA TYPES
**************************************************************************************************/

/**************************************************************************************************
*                                      VARIABLES
**************************************************************************************************/

uint8_t sdp_data[SDP_DATA_LEN];
uint8_t sdp_cmd[] = {0x36, 0x15};  //压差连续模式

/**************************************************************************************************
*                                      FUNCTION PROTOTYPES
**************************************************************************************************/

/**
* @brief  sdp3x传感器启动
*/
void bsp_sdp_start(void)
{
    i2c1_write(sdp_cmd, sizeof(sdp_cmd), ADDR_SDP31);
}
/**
* @brief  sdp3x传感器读数据
*/
void bsp_sdp_read(void)
{
    i2c1_read(sdp_data, SDP_DATA_LEN, ADDR_SDP31);
}
/**
* @brief  sdp3x传感器获取压差
*/
float bsp_sdp_get_press(void)
{
    float press = 0;
    
    press = (int16_t)(((uint16_t)sdp_data[0] << 8) + sdp_data[1]);
    press /= PRESS_DIF_1500_SCALE_FACTOR;
    
    return press;
}
/**
* @brief  sdp3x传感器获取温度
*/
float bsp_sdp_get_temp(void)
{
    float temp = 0;
    
    temp = (int16_t)(((uint16_t)sdp_data[3] << 8) + sdp_data[4]);
    temp /= TEMP_SCALE_FACTOR;
    
    return temp;
}
