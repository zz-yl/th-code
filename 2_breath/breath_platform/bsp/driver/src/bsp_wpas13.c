/**@file   bsp_wpas13.c
* @brief   wpas13压差传感器驱动
* @version 1.00.0.0
**************************************************************************************************/

/**************************************************************************************************
*                                      INCLUDE FILES
**************************************************************************************************/

#include "bsp_wpas13.h"
#include "bsp_i2c.h"

/**************************************************************************************************
*                                      MACROS DEFINE
**************************************************************************************************/

/**************************************************************************************************
*                                      DATA TYPES
**************************************************************************************************/

/**************************************************************************************************
*                                      VARIABLES
**************************************************************************************************/

uint8_t wpas13_data[WPAS13_DATA_LEN];
uint8_t wpas13_cmd[] = {0xB5};

/**************************************************************************************************
*                                      FUNCTION PROTOTYPES
**************************************************************************************************/

/**
* @brief  wpas31传感器启动
*/
void bsp_wpas31_start(void)
{
    i2c1_write(wpas13_cmd, sizeof(wpas13_cmd), ADDR_WPAS13);
}
/**
* @brief  wpas31传感器读数据
*/
void bsp_wpas31_read(void)
{
    static uint8_t rw_ctrl = 0;
    
    if(rw_ctrl)
    {
        rw_ctrl = 0;
        i2c1_write(wpas13_cmd, 1, ADDR_WPAS13);
    }
    else
    {
        rw_ctrl = 1;
        i2c1_read(wpas13_data, 6, ADDR_WPAS13);
    }
}
/**
* @brief  wpas31传感器获取压差
*/
float bsp_wpas31_get_press(void)
{
    uint32_t buf = 0;
    float press = 0;
    
    buf = ((uint32_t)wpas13_data[1] << 16) + ((uint32_t)wpas13_data[2] << 8) + wpas13_data[3];
    press = (float)buf / 0xFFFFFF * 3000 - 1500;
    
    return press;
}
/**
* @brief  wpas31传感器获取温度
*/
float bsp_wpas31_get_temp(void)
{
    float temp = 0;
    
    temp = (float)(((uint16_t)wpas13_data[4] << 8) + wpas13_data[5]) / 0xFFFF * 190 - 40;
    
    return temp;
}
